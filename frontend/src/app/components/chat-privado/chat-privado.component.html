<div class="chat-privado-container" *ngIf="usuarioSeleccionado">
  <!-- Header de conversación -->
  <div class="header-conversacion">
    <div class="usuario-header">
      <img 
        [src]="usuarioSeleccionado.fotoUsuario || 'assets/default-avatar.png'" 
        [alt]="usuarioSeleccionado.nickName"
        class="avatar"
      />
      <div class="usuario-info">
        <div class="nickname">{{ '@' + usuarioSeleccionado.nickName }}</div>
        <div class="nombre">{{ usuarioSeleccionado.nombre }} {{ usuarioSeleccionado.apellido }}</div>
      </div>
    </div>
  </div>

  <!-- Mensajes -->
  <div #mensajesContainer class="mensajes-container">
    <!-- Botón cargar más -->
    <button 
      *ngIf="hayMasMensajes && !cargandoMensajes"
      class="btn-cargar-mas"
      (click)="cargarMasMensajes()"
    >
      Cargar mensajes anteriores
    </button>

    <div *ngIf="cargandoMensajes && paginaActual === 0" class="loading">
      Cargando mensajes...
    </div>

    <!-- Lista de mensajes -->
    <div 
      *ngFor="let mensaje of conversacionActual"
      class="mensaje"
      [ngClass]="obtenerClasesMensaje(mensaje)"
    >
      <div class="mensaje-content">
        <p class="mensaje-texto">{{ mensaje.texto }}</p>
        <div class="mensaje-footer">
          <span class="fecha">{{ formatearFecha(mensaje.fechaDeCreado) }}</span>
          <span 
            *ngIf="mensaje.leido && mensaje.emisor.id === currentUserId" 
            class="leido-icon"
            title="Leído"
          >
            ✓✓
          </span>
        </div>
      </div>
    </div>

    <div *ngIf="conversacionActual.length === 0 && !cargandoMensajes" class="empty-state">
      <p>No hay mensajes en esta conversación</p>
      <p>¡Sé el primero en escribir!</p>
    </div>
  </div>

  <!-- Formulario de envío -->
  <div class="form-envio">
    <form [formGroup]="mensajeForm" (ngSubmit)="enviarMensaje()">
      <div class="input-container">
        <textarea
          formControlName="texto"
          placeholder="Escribe tu mensaje..."
          class="input-mensaje"
          rows="3"
          maxlength="1000"
        ></textarea>
        
        <div class="form-footer">
          <span class="contador">
            {{ longitudTexto }} / 1000
          </span>
          
          <button 
            type="submit"
            class="btn-enviar"
            [disabled]="!puedeEnviar"
          >
            {{ enviandoMensaje ? 'Enviando...' : 'Enviar' }}
          </button>
        </div>
      </div>

      <!-- Errores de validación -->
      <div class="validation-errors" *ngIf="mensajeForm.get('texto')?.invalid && mensajeForm.get('texto')?.touched">
        <p *ngIf="mensajeForm.get('texto')?.errors?.['required']">
          El mensaje no puede estar vacío
        </p>
        <p *ngIf="mensajeForm.get('texto')?.errors?.['maxlength']">
          El mensaje no puede exceder 1000 caracteres
        </p>
      </div>
    </form>
  </div>
</div>

<!-- Estado de carga inicial -->
<div *ngIf="!usuarioSeleccionado" class="loading-container">
  <div class="loading">Cargando conversación...</div>
</div>
